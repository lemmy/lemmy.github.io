<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>Viewers and 1:n associations with the EMF databinding - l e m m s t e r . d e</title>	
	<meta name="author" content="Markus A. Kuppe">
	

	<meta name="description" content="Examples on the evolving EMF databinding are still limited, so here's what I've learned recently. The use case is as follows, display the Collection (more precisely an EList) of Addresses a Person object owns (Person#addresses) in a JFace TableViewer. Before things can get started, one needs to grab a …">


	<link rel="top" href="#" /><link href='./theme/css/fonts.css' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
		


<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://lemmster.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src='//cdn.matomo.cloud/lemmster.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	    </div>
	      <nav class="pages">
			  <a href="./pages/gpg.html">gpg</a>
-			  <a href="./pages/impressum.html">impressum</a>
-			  <a href="./pages/resume.html">resume</a>
-			  <a href="./pages/talks.html">talks</a>
	      </nav>
		<a href="." class="title">l e m m s t e r . d e</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
			
		<h1>Viewers and 1:n associations with the EMF databinding</h1>
		
<div class="metadata">
  <time datetime="2008-01-28T08:53:19+01:00" pubdate>Mon 28 January 2008</time>
    <address class="vcard author">
      by <a class="url fn" href="./author/markus-a-kuppe.html">Markus A. Kuppe</a>
    </address>
  in <a href="./category/eclipse.html">eclipse</a>
</div>		
		<p><a href="http://wiki.eclipse.org/Wire_EMF_Databinding_RCP">Examples</a> on the evolving <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=75625">EMF databinding</a> are still limited, so here's what I've learned recently. The use case is as follows, display the Collection (more precisely an EList) of Addresses a Person object owns (Person#addresses) in a JFace TableViewer.  </p>
<p>Before things can get started, one needs to grab a recent version (recent in terms of HEAD because of <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=216440">#216440</a>) of EMF 2.4, which in turn requires <a href="http://download.eclipse.org/eclipse/downloads/">platform 3.4</a>. After defining EMF as a plug-in dependency, the Viewer's <em>Content</em>- and <em>LabelProvider</em> needs to be changed to:</p>
<div class="highlight"><pre><span></span>// The model object which should be shown
Person aPerson = ModelFactory.eINSTANCE.createPerson();
...

// The content provider is responsible to handle add and
// remove notification for the Person#address EList
ObservableListContentProvider provider = new ObservableListContentProvider();
viewer.setContentProvider(provider);

// The label provider in turn handles the addresses
// The EStructuralFeature[] defines which fields get shown
// in the TableViewer columns
IObservableSet knownElements = provider.getKnownElements();
IObservableMap[] observeMaps = EMFObservables.
    observeMaps(knownElements, new EStructuralFeature[] {
    ModelPackage.Literals.PERSON_ADDRESS__STREET,
    ModelPackage.Literals.PERSON_ADDRESS__NUMBER,
    ModelPackage.Literals.PERSON_ADDRESS__ZIP,
    ModelPackage.Literals.PERSON_ADDRESS__COUNTRY);
ObservableMapLabelProvider labelProvider = 
    new ObservableMapLabelProvider(observeMaps);
viewer.setLabelProvider(labelProvider);

// Person#addresses is the Viewer&#39;s input
viewer.setInput(EMFObservables.observeList(Realm.getDefault(), aPerson, 
    ModelPackage.Literals.PERSON_ADDRESSES));
</pre></div>


<p>This is pretty much everything what's necessary to display the Addresses details in the TableViewer and to react to EMF notifications. One doesn't even have to write a custom <em>Content-</em> and <em>LabelProviders</em>. 
Though the databinding has some limitation in this early incarnation:</p>
<ul>
<li>
<p>One might want to delegate to an existing EMF edit in the LabelProvider, thus an EMF version of the <em>ObservableMapLabelProvider</em> would be required</p>
</li>
<li>
<p>No support for non EMF/custom columns. If a table column is to be filled by a different source than an EMF field e.g. calculation usually done in the <em>LabelProvider</em></p>
</li>
<li>
<p>EMF proxies don't get resolved under certain conditions which result in NPEs in the LabelProvider or Comparators</p>
</li>
</ul>
<p>Edit: Following Ed's suggestion I've created a <a href="http://wiki.eclipse.org/EMF/Recipes#Recipe:_JFace_Viewers_and_1:n_associations">EMF recipe</a> and bug <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=216748">216748</a></p>	

	</article>

	    <section id="comments" class="body">
	    <hr><p>Want to comment? Send me an email to blog-comments-2019 at lemmster d.t de and I'll paste it here (I won't publish your address). Why don't you use an external comment service like disqus, you ask? Well, I like to keep this site under my control, comments included. You can use markdown to format your comment.</p>
	<h2>Comment by Ed Merks | 2008/01/28 at 12:35:09</h2>
<p>Cool! You’d be more than welcome to create a data binding section in EMF’s recipes wiki. Be sure to include your name with the contribution so you can take credit for it. A label provider that delegates to EMF’s item providers makes a lot of sense, i.e., AdapterFactoryObservableMapLabelProvider. Feel free to open a bugzilla feature request for that. We could prototype something together to see how it works out…</p>
<h2>Comment by Boris Bokowski | 2008/01/28 at 16:11:48</h2>
<p>To customize the labels (e.g. let them display a calculated value), you can subclass ObservableMapLabelProvider. One of the snippets (Snippet007ColorLabelProvider) shows an example of this. Also, we have a patch attached to https://bugs.eclipse.org/bugs/show_bug.cgi?id=196785 for derived attributes (e.g., when the person’s address is a separate object containing street, city, …).</p>
<h2>Comment by markus | 2008/01/28 at 16:26:14</h2>
<p>Hi Boris,
doing the custom labels in the LabelProvider might lead to the problem of missed notifications to the values on which the custom label is based. To avoid this, I’d prefer adding the custom value in the EMF layer and handling the recalculation there. Unfortunately method don’t show up as EStructuralFeature. Surely this only makes sense if the custom label fits into the model.</p>
<h2>Comment by Chandresh Gandhi | 2010/02/18 at 12:41:11</h2>
<p>Hi Markus,</p>
<p>Currently I’m putting hands on EMF Databinding Framework and caught your example / use-case same as my requirement.
I’d given it try to display EList (Address), a Person object holds. But It only shows “Street – PERSON_ADDRESS__STREET ” attribute.</p>
<p>Can you please point me out where did I make mistake. I’d expected “All address attributes for a person” to be show in table.
Following is my code.</p>
<pre><code>public class EMFDatabindingView extends ViewPart {

private TableViewer viewer;

public EMFDatabindingView() {
// TODO Auto-generated constructor stub
}

@Override
public void createPartControl(Composite parent) {

viewer = new TableViewer(parent, SWT.FULL_SELECTION);
viewer.getTable().setHeaderVisible(true);

ObservableListContentProvider provider = new ObservableListContentProvider();
viewer.setContentProvider(provider);

IObservableSet knownElements = provider.getKnownElements();
IObservableMap[] observeMaps = EMFObservables.observeMaps(knownElements,
new EStructuralFeature[] {
EmfdatabindingPackage.Literals.PERSON_ADDRESS__STREET,
EmfdatabindingPackage.Literals.PERSON_ADDRESS__CITY,
EmfdatabindingPackage.Literals.PERSON_ADDRESS__COUNTRY,
EmfdatabindingPackage.Literals.PERSON_ADDRESS__ZIP
});
ObservableMapLabelProvider labelProvider = new ObservableMapLabelProvider(observeMaps);
viewer.setLabelProvider(labelProvider);

viewer.setInput(EMFObservables.observeList(Realm.getDefault(), getPerson(),
EmfdatabindingPackage.Literals.PERSON__ADDRESSES));
}

private Person getPerson(){

Person person = EmfdatabindingFactory.eINSTANCE.createPerson();
person.setName(” Chandresh Gandhi “);

PersonAddress address = EmfdatabindingFactory.eINSTANCE.createPersonAddress();
address.setStreet(” Kamdar Street “);
address.setCity(” Dhoraji – Rajkot”);
address.setCountry(“India”);
address.setZip(“360 410″);

person.getAddresses().add(address);

return person;
}

@Override
public void setFocus()
{

}
}
</code></pre>
	    </section>

		  </div>	
		  
		  <div class="sidebar">

	        <nav>
	          <h2>Categories</h2>
	          <ul>
	              <li class="active"><a href="./category/eclipse.html">eclipse</a></li>
	              <li ><a href="./category/hacks.html">hacks</a></li>
	              <li ><a href="./category/tla.html">TLA+</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="https://github.com/lemmy">Github</a><i></i></li>
				  <li><a href="https://twitter.com/lemmster">Twitter</a><i></i></li>
				  <li><a href="https://bitbucket.org/lemmster">Bitbucket</a><i></i></li>
				  <li><a href="https://www.ohloh.net/accounts/lemmy">Ohloh</a><i></i></li>
			    </ul>
			  </aside>


		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  © 2019 Markus A. Kuppe.
    	</p>

	  </footer>	

	</div>
	

</body>
</html>